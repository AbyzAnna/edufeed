generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  User              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Answer {
  id          String      @id
  attemptId   String
  questionId  String
  userAnswer  String
  isCorrect   Boolean
  timeSpent   Int?
  createdAt   DateTime    @default(now())
  QuizAttempt QuizAttempt @relation(fields: [attemptId], references: [id], onDelete: Cascade)
  Question    Question    @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@index([attemptId])
}

model Bookmark {
  id        String   @id
  userId    String
  videoId   String
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  Video     Video    @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@unique([userId, videoId])
}

model Chapter {
  id              String       @id
  mediaContentId  String
  title           String
  startTime       Int
  endTime         Int?
  isAutoGenerated Boolean      @default(false)
  order           Int          @default(0)
  MediaContent    MediaContent @relation(fields: [mediaContentId], references: [id], onDelete: Cascade)

  @@index([mediaContentId])
}

model Comment {
  id            String        @id
  userId        String
  feedItemId    String
  content       String
  parentId      String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  FeedItem      FeedItem      @relation(fields: [feedItemId], references: [id], onDelete: Cascade)
  Comment       Comment?      @relation("CommentToComment", fields: [parentId], references: [id], onDelete: Cascade)
  other_Comment Comment[]     @relation("CommentToComment")
  User          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  CommentLike   CommentLike[]

  @@index([feedItemId])
  @@index([parentId])
  @@index([userId])
}

model CommentLike {
  id        String   @id
  userId    String
  commentId String
  createdAt DateTime @default(now())
  Comment   Comment  @relation(fields: [commentId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, commentId])
  @@index([commentId])
  @@index([userId])
}

model ContentModerationReport {
  id                                            String                @id
  contentType                                   ModerationContentType
  contentId                                     String
  userId                                        String
  originalContent                               String
  status                                        ModerationStatus      @default(PENDING)
  decision                                      ModerationDecision?
  violations                                    Json
  confidenceScore                               Float                 @default(0)
  aiModelVersion                                String
  reviewerId                                    String?
  reviewNotes                                   String?
  appealReason                                  String?
  appealedAt                                    DateTime?
  resolvedAt                                    DateTime?
  createdAt                                     DateTime              @default(now())
  updatedAt                                     DateTime
  User_ContentModerationReport_reviewerIdToUser User?                 @relation("ContentModerationReport_reviewerIdToUser", fields: [reviewerId], references: [id])
  User_ContentModerationReport_userIdToUser     User                  @relation("ContentModerationReport_userIdToUser", fields: [userId], references: [id], onDelete: Cascade)

  @@index([contentType, contentId])
  @@index([createdAt])
  @@index([status])
  @@index([userId])
}

model ContentTable {
  id         String   @id
  feedItemId String   @unique
  tableTitle String
  headers    String[]
  rows       Json
  caption    String?
  createdAt  DateTime @default(now())
  FeedItem   FeedItem @relation(fields: [feedItemId], references: [id], onDelete: Cascade)
}

model Conversation {
  id                      String                    @id
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  ConversationParticipant ConversationParticipant[]
  DirectMessage           DirectMessage[]

  @@index([updatedAt])
}

model ConversationParticipant {
  id             String       @id
  conversationId String
  userId         String
  lastReadAt     DateTime     @default(now())
  joinedAt       DateTime     @default(now())
  Conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  User           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@index([userId])
}

model Deck {
  id          String      @id
  userId      String
  title       String
  description String?
  color       String?
  isPublic    Boolean     @default(false)
  sourceId    String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime
  feedItemId  String?     @unique
  FeedItem    FeedItem?   @relation(fields: [feedItemId], references: [id])
  Source      Source?     @relation(fields: [sourceId], references: [id])
  User        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  Flashcard   Flashcard[]

  @@index([userId])
}

model DirectMessage {
  id                                  String       @id
  conversationId                      String
  senderId                            String
  receiverId                          String
  content                             String?
  sharedFeedItemId                    String?
  isRead                              Boolean      @default(false)
  createdAt                           DateTime     @default(now())
  Conversation                        Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  User_DirectMessage_receiverIdToUser User         @relation("DirectMessage_receiverIdToUser", fields: [receiverId], references: [id], onDelete: Cascade)
  User_DirectMessage_senderIdToUser   User         @relation("DirectMessage_senderIdToUser", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([receiverId])
  @@index([senderId])
}

model EmailVerificationToken {
  id        String   @id
  email     String   @unique
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([email])
  @@index([token])
}

model FeedBookmark {
  id         String   @id
  userId     String
  feedItemId String
  createdAt  DateTime @default(now())
  FeedItem   FeedItem @relation(fields: [feedItemId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, feedItemId])
  @@index([userId])
  @@index([feedItemId])
}

model FeedItem {
  id           String         @id
  userId       String
  sourceId     String
  type         FeedItemType
  title        String
  description  String?
  status       ContentStatus  @default(PENDING)
  audioUrl     String?
  thumbnailUrl String?
  viewCount    Int            @default(0)
  topic        String?
  tags         String[]
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  Comment      Comment[]
  ContentTable ContentTable?
  Deck         Deck?
  FeedBookmark FeedBookmark[]
  Source       Source         @relation(fields: [sourceId], references: [id], onDelete: Cascade)
  User         User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  FeedLike     FeedLike[]
  Share        Share[]
  Summary      Summary?

  @@index([status])
  @@index([type])
  @@index([userId])
  @@index([createdAt])
  @@index([sourceId])
}

model FeedLike {
  id         String   @id
  userId     String
  feedItemId String
  createdAt  DateTime @default(now())
  FeedItem   FeedItem @relation(fields: [feedItemId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, feedItemId])
  @@index([userId])
  @@index([feedItemId])
}

model Flashcard {
  id              String            @id
  deckId          String
  front           String
  back            String
  hint            String?
  imageUrl        String?
  audioUrl        String?
  easeFactor      Float             @default(2.5)
  interval        Int               @default(0)
  repetitions     Int               @default(0)
  nextReviewDate  DateTime          @default(now())
  lastReviewDate  DateTime?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  Deck            Deck              @relation(fields: [deckId], references: [id], onDelete: Cascade)
  FlashcardReview FlashcardReview[]

  @@index([deckId])
  @@index([nextReviewDate])
}

model FlashcardReview {
  id          String    @id
  flashcardId String
  userId      String
  quality     Int
  responseMs  Int?
  // User-specific SM2 values for tracking progress on public decks
  // Without modifying the original card's values
  easeFactor  Float?
  interval    Int?
  repetitions Int?
  createdAt   DateTime  @default(now())
  Flashcard   Flashcard @relation(fields: [flashcardId], references: [id], onDelete: Cascade)
  User        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([flashcardId])
  @@index([userId])
  @@index([flashcardId, userId]) // For efficient lookup of user's last review
}

model Follow {
  id                            String   @id
  followerId                    String
  followingId                   String
  createdAt                     DateTime @default(now())
  User_Follow_followerIdToUser  User     @relation("Follow_followerIdToUser", fields: [followerId], references: [id], onDelete: Cascade)
  User_Follow_followingIdToUser User     @relation("Follow_followingIdToUser", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

model Like {
  id        String   @id
  userId    String
  videoId   String
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  Video     Video    @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@unique([userId, videoId])
}

model MediaBookmark {
  id             String       @id
  mediaContentId String
  userId         String
  timestamp      Int
  label          String?
  createdAt      DateTime     @default(now())
  MediaContent   MediaContent @relation(fields: [mediaContentId], references: [id], onDelete: Cascade)
  User           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, mediaContentId, timestamp])
  @@index([mediaContentId])
}

model MediaContent {
  id            String          @id
  userId        String
  type          MediaType
  title         String
  description   String?
  url           String
  fileUrl       String?
  thumbnailUrl  String?
  duration      Int?
  transcript    String?
  sourceId      String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  Chapter       Chapter[]
  MediaBookmark MediaBookmark[]
  Source        Source?         @relation(fields: [sourceId], references: [id])
  User          User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  MediaNote     MediaNote[]

  @@index([type])
  @@index([userId])
}

model MediaNote {
  id             String       @id
  mediaContentId String
  userId         String
  timestamp      Int
  content        String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
  MediaContent   MediaContent @relation(fields: [mediaContentId], references: [id], onDelete: Cascade)
  User           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([mediaContentId])
  @@index([userId])
}

model Notebook {
  id                   String                 @id @default(cuid())
  userId               String
  groupId              String?
  title                String
  description          String?
  emoji                String?                @default("üìö")
  color                String?                @default("#6366f1")
  isPublic             Boolean                @default(false)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  User                 User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  NotebookGroup        NotebookGroup?         @relation(fields: [groupId], references: [id], onDelete: SetNull)
  NotebookChat         NotebookChat[]
  NotebookCollaborator NotebookCollaborator[]
  NotebookOutput       NotebookOutput[]
  NotebookSource       NotebookSource[]
  StudyRoom            StudyRoom[]

  @@index([userId])
  @@index([groupId])
}

model NotebookGroup {
  id          String     @id @default(cuid())
  userId      String
  name        String
  description String?
  emoji       String?    @default("üìÅ")
  color       String?    @default("#8b5cf6")
  order       Int        @default(0)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  User        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  Notebooks   Notebook[]

  @@unique([userId, name])
  @@index([userId])
  @@index([order])
}

model NotebookChat {
  id               String             @id
  notebookId       String
  userId           String
  role             ChatRole
  content          String
  createdAt        DateTime           @default(now())
  Notebook         Notebook           @relation(fields: [notebookId], references: [id], onDelete: Cascade)
  NotebookCitation NotebookCitation[]

  @@index([notebookId])
  @@index([userId])
  @@index([createdAt])
}

model NotebookCitation {
  id             String         @id
  chatId         String
  sourceId       String
  excerpt        String
  startOffset    Int?
  endOffset      Int?
  NotebookChat   NotebookChat   @relation(fields: [chatId], references: [id], onDelete: Cascade)
  NotebookSource NotebookSource @relation(fields: [sourceId], references: [id], onDelete: Cascade)

  @@index([chatId])
  @@index([sourceId])
}

model NotebookCollaborator {
  id         String           @id
  notebookId String
  userId     String
  role       CollaboratorRole @default(VIEWER)
  invitedAt  DateTime         @default(now())
  Notebook   Notebook         @relation(fields: [notebookId], references: [id], onDelete: Cascade)

  @@unique([notebookId, userId])
  @@index([userId])
}

model NotebookOutput {
  id         String             @id @default(cuid())
  notebookId String
  type       NotebookOutputType
  title      String
  content    Json
  audioUrl   String?
  status     ContentStatus      @default(PENDING)
  createdAt  DateTime           @default(now())
  updatedAt  DateTime           @updatedAt
  Notebook   Notebook           @relation(fields: [notebookId], references: [id], onDelete: Cascade)

  @@index([notebookId])
  @@index([type])
}

model NotebookSource {
  id               String                 @id @default(cuid())
  notebookId       String
  type             NotebookSourceType
  title            String
  originalUrl      String?
  content          String?
  rawContent       String?
  fileUrl          String?
  metadata         Json?
  wordCount        Int?
  status           SourceProcessingStatus @default(PENDING)
  errorMessage     String?
  lastSyncedAt     DateTime?
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  NotebookCitation NotebookCitation[]
  Notebook         Notebook               @relation(fields: [notebookId], references: [id], onDelete: Cascade)
  SourceEmbedding  SourceEmbedding[]

  @@index([notebookId])
  @@index([status])
}

model Notification {
  id         String           @id
  userId     String
  type       NotificationType
  title      String
  message    String?
  actorId    String?
  targetId   String?
  targetType String?
  isRead     Boolean          @default(false)
  createdAt  DateTime         @default(now())
  User       User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([isRead])
  @@index([userId])
}

model PasswordResetToken {
  id        String   @id
  email     String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([email])
  @@index([token])
}

model PodcastEpisode {
  id          String      @id
  feedId      String
  guid        String
  title       String
  description String?
  audioUrl    String
  duration    Int?
  publishedAt DateTime?
  transcript  String?
  PodcastFeed PodcastFeed @relation(fields: [feedId], references: [id], onDelete: Cascade)

  @@unique([feedId, guid])
  @@index([feedId])
}

model PodcastFeed {
  id             String           @id
  userId         String
  feedUrl        String
  title          String
  description    String?
  imageUrl       String?
  author         String?
  lastFetched    DateTime?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  PodcastEpisode PodcastEpisode[]
  User           User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, feedUrl])
  @@index([userId])
}

model Question {
  id            String       @id
  quizId        String
  type          QuestionType
  text          String
  explanation   String?
  imageUrl      String?
  options       Json?
  correctAnswer String?
  points        Int          @default(1)
  order         Int          @default(0)
  createdAt     DateTime     @default(now())
  Answer        Answer[]
  Quiz          Quiz         @relation(fields: [quizId], references: [id], onDelete: Cascade)

  @@index([quizId])
}

model Quiz {
  id          String         @id
  userId      String
  title       String
  description String?
  sourceId    String?
  difficulty  QuizDifficulty @default(MEDIUM)
  timeLimit   Int?
  isPublic    Boolean        @default(false)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime
  Question    Question[]
  Source      Source?        @relation(fields: [sourceId], references: [id])
  User        User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  QuizAttempt QuizAttempt[]

  @@index([userId])
}

model QuizAttempt {
  id          String    @id
  quizId      String
  userId      String
  score       Int       @default(0)
  maxScore    Int
  percentage  Float     @default(0)
  timeSpent   Int       @default(0)
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  Answer      Answer[]
  Quiz        Quiz      @relation(fields: [quizId], references: [id], onDelete: Cascade)
  User        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([quizId])
  @@index([userId])
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Share {
  id               String    @id
  userId           String
  feedItemId       String
  shareType        ShareType
  sharedToUserId   String?
  externalPlatform String?
  createdAt        DateTime  @default(now())
  FeedItem         FeedItem  @relation(fields: [feedItemId], references: [id], onDelete: Cascade)
  User             User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([feedItemId])
  @@index([userId])
}

model Source {
  id           String         @id
  userId       String
  type         SourceType
  title        String
  content      String?
  originalUrl  String?
  fileUrl      String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  Deck         Deck[]
  FeedItem     FeedItem[]
  MediaContent MediaContent[]
  Quiz         Quiz[]
  User         User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  Video        Video[]
}

model SourceEmbedding {
  id             String         @id
  sourceId       String
  chunkIndex     Int
  chunkText      String
  embedding      String?
  vectorId       String?
  createdAt      DateTime       @default(now())
  NotebookSource NotebookSource @relation(fields: [sourceId], references: [id], onDelete: Cascade)

  @@unique([sourceId, chunkIndex])
  @@index([sourceId])
}

model StudyRoom {
  id                   String                 @id
  hostId               String
  notebookId           String?
  title                String
  description          String?
  code                 String                 @unique
  isActive             Boolean                @default(true)
  isPrivate            Boolean                @default(false)
  maxParticipants      Int                    @default(10)
  scheduledFor         DateTime?
  startedAt            DateTime?
  endedAt              DateTime?
  settings             Json?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  User                 User                   @relation(fields: [hostId], references: [id], onDelete: Cascade)
  Notebook             Notebook?              @relation(fields: [notebookId], references: [id])
  StudyRoomAnnotation  StudyRoomAnnotation[]
  StudyRoomInvite      StudyRoomInvite[]
  StudyRoomMessage     StudyRoomMessage[]
  StudyRoomParticipant StudyRoomParticipant[]
  StudySession         StudySession[]

  @@index([code])
  @@index([hostId])
  @@index([isActive])
}

model StudyRoomAnnotation {
  id          String         @id
  roomId      String
  userId      String
  sourceId    String?
  type        AnnotationType
  content     String
  startOffset Int?
  endOffset   Int?
  color       String?
  isResolved  Boolean        @default(false)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime
  StudyRoom   StudyRoom      @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@index([roomId])
  @@index([sourceId])
}

model StudyRoomInvite {
  id        String       @id
  roomId    String
  inviterId String
  inviteeId String?
  email     String?
  status    InviteStatus @default(PENDING)
  expiresAt DateTime
  createdAt DateTime     @default(now())
  StudyRoom StudyRoom    @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@index([inviteeId])
  @@index([roomId])
}

model StudyRoomMessage {
  id                     String             @id
  roomId                 String
  userId                 String
  type                   RoomMessageType    @default(TEXT)
  content                String
  metadata               Json?
  replyToId              String?
  createdAt              DateTime           @default(now())
  StudyRoomMessage       StudyRoomMessage?  @relation("StudyRoomMessageToStudyRoomMessage", fields: [replyToId], references: [id])
  other_StudyRoomMessage StudyRoomMessage[] @relation("StudyRoomMessageToStudyRoomMessage")
  StudyRoom              StudyRoom          @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@index([roomId])
  @@index([userId])
}

model StudyRoomParticipant {
  id             String            @id
  roomId         String
  userId         String
  role           ParticipantRole   @default(PARTICIPANT)
  status         ParticipantStatus @default(OFFLINE)
  joinedAt       DateTime          @default(now())
  leftAt         DateTime?
  cursorPosition Json?
  isAudioOn      Boolean           @default(false)
  isVideoOn      Boolean           @default(false)
  isSpeaking     Boolean           @default(false)
  StudyRoom      StudyRoom         @relation(fields: [roomId], references: [id], onDelete: Cascade)
  User           User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([roomId, userId])
  @@index([roomId])
  @@index([status])
  @@index([userId])
}

model StudySession {
  id           String    @id
  roomId       String
  title        String?
  summary      String?
  keyPoints    String[]
  duration     Int?
  startedAt    DateTime
  endedAt      DateTime?
  recordingUrl String?
  createdAt    DateTime  @default(now())
  StudyRoom    StudyRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@index([roomId])
}

model Summary {
  id         String   @id
  feedItemId String   @unique
  content    String
  keyPoints  String[]
  highlights String[]
  readTime   Int?
  createdAt  DateTime @default(now())
  FeedItem   FeedItem @relation(fields: [feedItemId], references: [id], onDelete: Cascade)
}

model Topic {
  id          String   @id
  name        String   @unique
  slug        String   @unique
  description String?
  icon        String?
  color       String?
  createdAt   DateTime @default(now())
}

model User {
  id                                                               String                    @id
  name                                                             String?
  email                                                            String?                   @unique
  emailVerified                                                    DateTime?
  image                                                            String?
  bio                                                              String?
  username                                                         String?                   @unique
  pushToken                                                        String?
  appleUserId                                                      String?                   @unique
  lastActiveAt                                                     DateTime?
  createdAt                                                        DateTime                  @default(now())
  updatedAt                                                        DateTime
  Account                                                          Account[]
  Bookmark                                                         Bookmark[]
  Comment                                                          Comment[]
  CommentLike                                                      CommentLike[]
  ContentModerationReport_ContentModerationReport_reviewerIdToUser ContentModerationReport[] @relation("ContentModerationReport_reviewerIdToUser")
  ContentModerationReport_ContentModerationReport_userIdToUser     ContentModerationReport[] @relation("ContentModerationReport_userIdToUser")
  ConversationParticipant                                          ConversationParticipant[]
  Deck                                                             Deck[]
  DirectMessage_DirectMessage_receiverIdToUser                     DirectMessage[]           @relation("DirectMessage_receiverIdToUser")
  DirectMessage_DirectMessage_senderIdToUser                       DirectMessage[]           @relation("DirectMessage_senderIdToUser")
  FeedBookmark                                                     FeedBookmark[]
  FeedItem                                                         FeedItem[]
  FeedLike                                                         FeedLike[]
  FlashcardReview                                                  FlashcardReview[]
  Follow_Follow_followerIdToUser                                   Follow[]                  @relation("Follow_followerIdToUser")
  Follow_Follow_followingIdToUser                                  Follow[]                  @relation("Follow_followingIdToUser")
  Like                                                             Like[]
  MediaBookmark                                                    MediaBookmark[]
  MediaContent                                                     MediaContent[]
  MediaNote                                                        MediaNote[]
  Notebook                                                         Notebook[]
  NotebookGroup                                                    NotebookGroup[]
  Notification                                                     Notification[]
  PodcastFeed                                                      PodcastFeed[]
  Quiz                                                             Quiz[]
  QuizAttempt                                                      QuizAttempt[]
  Session                                                          Session[]
  Share                                                            Share[]
  Source                                                           Source[]
  StudyRoom                                                        StudyRoom[]
  StudyRoomParticipant                                             StudyRoomParticipant[]
  UserModerationHistory                                            UserModerationHistory?
  Video                                                            Video[]
}

model UserModerationHistory {
  id            String               @id
  userId        String               @unique
  totalReports  Int                  @default(0)
  approvedCount Int                  @default(0)
  rejectedCount Int                  @default(0)
  warningCount  Int                  @default(0)
  currentStatus UserModerationStatus @default(GOOD_STANDING)
  lastViolation DateTime?
  muteExpiresAt DateTime?
  createdAt     DateTime             @default(now())
  updatedAt     DateTime
  User          User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Video {
  id             String         @id
  userId         String
  sourceId       String
  title          String
  description    String?
  videoUrl       String?
  thumbnailUrl   String?
  duration       Int?
  status         VideoStatus    @default(PENDING)
  generationType GenerationType @default(SLIDESHOW)
  script         String?
  topic          String?
  tags           String[]
  youtubeVideoId String?
  youtubeStart   Int?
  youtubeEnd     Int?
  viewCount      Int            @default(0)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime
  Bookmark       Bookmark[]
  Like           Like[]
  Source         Source         @relation(fields: [sourceId], references: [id], onDelete: Cascade)
  User           User           @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum AnnotationType {
  HIGHLIGHT
  COMMENT
  QUESTION
  BOOKMARK
}

enum ChatRole {
  USER
  ASSISTANT
  SYSTEM
}

enum CollaboratorRole {
  OWNER
  EDITOR
  VIEWER
}

enum ContentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum FeedItemType {
  FLASHCARD_DECK
  SUMMARY
  TABLE
  AUDIO_SUMMARY
}

enum GenerationType {
  SLIDESHOW
  AI_VIDEO
  AVATAR
  WAN_VIDEO
}

enum InviteStatus {
  PENDING
  ACCEPTED
  DECLINED
  EXPIRED
}

enum MediaType {
  YOUTUBE
  PODCAST
  AUDIO
  VIDEO
}

enum ModerationContentType {
  COMMENT
  DIRECT_MESSAGE
  STUDY_ROOM_MESSAGE
  NOTEBOOK_CONTENT
  NOTEBOOK_SOURCE
  FLASHCARD
  FEED_ITEM
}

enum ModerationDecision {
  APPROVED
  REJECTED
  WARNING_ISSUED
  CONTENT_MODIFIED
}

enum ModerationStatus {
  PENDING
  AUTO_APPROVED
  AUTO_REJECTED
  MANUAL_REVIEW
  APPROVED
  REJECTED
  APPEALED
  ESCALATED
}

enum NotebookOutputType {
  SUMMARY
  STUDY_GUIDE
  FAQ
  BRIEFING_DOC
  TIMELINE
  MIND_MAP
  AUDIO_OVERVIEW
  FLASHCARD_DECK
  QUIZ
  DATA_TABLE
  VIDEO_OVERVIEW
}

enum NotebookSourceType {
  URL
  PDF
  YOUTUBE
  TEXT
  GOOGLE_DOC
  IMAGE
  AUDIO
}

enum NotificationType {
  LIKE
  COMMENT
  FOLLOW
  MESSAGE
  SHARE
  MENTION
  STUDY_ROOM_INVITE
  NOTEBOOK_SHARED
}

enum ParticipantRole {
  HOST
  MODERATOR
  PARTICIPANT
}

enum ParticipantStatus {
  ONLINE
  AWAY
  OFFLINE
}

enum QuestionType {
  MULTIPLE_CHOICE
  TRUE_FALSE
  FILL_IN_BLANK
  SHORT_ANSWER
}

enum QuizDifficulty {
  EASY
  MEDIUM
  HARD
  ADAPTIVE
}

enum RoomMessageType {
  TEXT
  SYSTEM
  AI_RESPONSE
  HIGHLIGHT
  QUESTION
  POLL
}

enum ShareType {
  INTERNAL
  EXTERNAL
  COPY_LINK
}

enum SourceProcessingStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum SourceType {
  PDF
  URL
  TEXT
  YOUTUBE
}

enum UserModerationStatus {
  GOOD_STANDING
  WARNING
  MUTED
  UNDER_REVIEW
  SUSPENDED
}

enum VideoStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}
